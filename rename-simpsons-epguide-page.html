#!/usr/bin/perl

#030809, dulu pernah buat sih tapi lupa

use HTML::Entities;

die "Usage: $0 <file> ...\nExample: $0 1410.htm\n" unless @ARGV;

for $f (@ARGV) {
    ($ep) = $f =~ /^(\d{3,4})\.htm$/i or do { warn "WARN: File does not have the right name: $f, skipped\n"; next };
    
    open F, $f; $content = join "", <F>; close F;
    ($title) = $content =~ m#<span class="epiHead">&quot;(.+?)&quot;</span>#i or do { warn "WARN: File does not contain title: $f, skipped\n"; next };
    $title = decode_entities($title);
    
    $newf = "The Simpsons - $ep - $title.html";
    print "$f -> $newf\n";
    rename $f, $newf or warn "WARN: Can't rename: $!\n";
}
