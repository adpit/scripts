#!/bin/sh
echo 1 > /proc/sys/net/ipv4/ip_forward

IPTABLES=/sbin/iptables

#nanti pakai sebelumnya /c/etc/rc.local.common lagi, yang berisi /c/sbin/iptables-load_blocklist.pl. jadi ntar comment out.
$IPTABLES -F INPUT

$IPTABLES -F OUTPUT

$IPTABLES -t nat -F

# ---

$IPTABLES -P FORWARD ACCEPT
$IPTABLES -t nat -A POSTROUTING -o ppp+ -j MASQUERADE

# i hate codered! 010904
$IPTABLES -p TCP -A INPUT -s 127.0.0.1 -j ACCEPT
$IPTABLES -p TCP -A INPUT -s '!' 192.168.0.0/16 --dport 80 -j DROP
# banyak juga yang scan port ftp. i'll block some other ports 021121
$IPTABLES -p TCP -A INPUT -s '!' 192.168.0.0/16 --dport 22 -j DROP # ssh
$IPTABLES -p TCP -A INPUT -s '!' 192.168.0.0/16 --dport 23 -j DROP # telnet
$IPTABLES -p TCP -A INPUT -s '!' 192.168.0.0/16 --dport 53 -j DROP # dns
$IPTABLES -p TCP -A INPUT -s '!' 192.168.0.0/16 --dport 21 -j DROP # ftp
#$IPTABLES -p TCP -A INPUT -s '!' 192.168.0.0/16 --dport 25 -j DROP # smtp
$IPTABLES -p TCP -A INPUT -s '!' 192.168.0.0/16 --dport 137 -j DROP # netbios
$IPTABLES -p TCP -A INPUT -s '!' 192.168.0.0/16 --dport 138 -j DROP # netbios
$IPTABLES -p TCP -A INPUT -s '!' 192.168.0.0/16 --dport 139 -j DROP # netbios

# popup sites yang pake ip. block em all. -- sekarang pake squid aja
# $IPTABLES -t nat -p TCP -A OUTPUT -d 208.63.69.8 -j DROP
# climaxbucks ini jahat, memberi internet-optimizer
$IPTABLES -p TCP -A INPUT -s 216.187.107.3 -j DROP
$IPTABLES -p TCP -A INPUT -s 216.187.107.4 -j DROP

# transparent squid - 020319
#$IPTABLES -t nat -A PREROUTING -i eth+ -p tcp -d '!' 192.168.0.0/16 --dport 80 -j REDIRECT --to-port 8080

